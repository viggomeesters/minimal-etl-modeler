<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Minimal ETL Modeler</title>
    <link rel="stylesheet" href="style.css">
    <!-- SheetJS for XLSX export support -->
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
</head>
<body>
    <div class="container">
        <header>
            <h1>Minimal ETL Modeler</h1>
            <p class="subtitle">Lightweight ‚Ä¢ Scalable ‚Ä¢ Minimalistic</p>
        </header>
        
        <div class="workspace">
            <!-- Toolbox with draggable components -->
            <aside class="toolbox">
                <h3>Components</h3>
                
                <!-- Input/Output Group -->
                <div class="tool-group">
                    <div class="tool-group-header" data-group="input-output">
                        <span class="group-icon">‚ñº</span>
                        <span class="group-title">Input/Output</span>
                    </div>
                    <div class="tool-group-items" data-group-items="input-output">
                        <div class="tool-item" draggable="true" data-type="input">
                            <span class="icon">üì•</span>
                            <span>Input Source Data</span>
                        </div>
                        <div class="tool-item" draggable="true" data-type="output">
                            <span class="icon">üì§</span>
                            <span>Target Structure</span>
                        </div>
                        <div class="tool-item" draggable="true" data-type="outputdata">
                            <span class="icon">üíæ</span>
                            <span>Output Data</span>
                        </div>
                        <div class="tool-item" draggable="true" data-type="rejectedoutput">
                            <span class="icon">üö´</span>
                            <span>Rejected Output</span>
                        </div>
                    </div>
                </div>
                
                <!-- Mapping & Transformation Group -->
                <div class="tool-group">
                    <div class="tool-group-header" data-group="mapping">
                        <span class="group-icon">‚ñº</span>
                        <span class="group-title">Mapping</span>
                    </div>
                    <div class="tool-group-items" data-group-items="mapping">
                        <div class="tool-item" draggable="true" data-type="automapper">
                            <span class="icon">ü§ñ</span>
                            <span>Automapper</span>
                        </div>
                        <div class="tool-item" draggable="true" data-type="mapping">
                            <span class="icon">üîó</span>
                            <span>Mapping</span>
                        </div>
                        <div class="tool-item" draggable="true" data-type="valuemapper">
                            <span class="icon">üîÑ</span>
                            <span>Value Mapper</span>
                        </div>
                    </div>
                </div>
                
                <!-- Data Operations Group -->
                <div class="tool-group">
                    <div class="tool-group-header" data-group="data-ops">
                        <span class="group-icon">‚ñº</span>
                        <span class="group-title">Data Operations</span>
                    </div>
                    <div class="tool-group-items" data-group-items="data-ops">
                        <div class="tool-item" draggable="true" data-type="join">
                            <span class="icon">üîÄ</span>
                            <span>Join</span>
                        </div>
                        <div class="tool-item" draggable="true" data-type="validation">
                            <span class="icon">‚úì</span>
                            <span>Validation</span>
                        </div>
                    </div>
                </div>
                
                <!-- Text Transformations Group -->
                <div class="tool-group">
                    <div class="tool-group-header" data-group="text-transform">
                        <span class="group-icon">‚ñº</span>
                        <span class="group-title">Text Operations</span>
                    </div>
                    <div class="tool-group-items" data-group-items="text-transform">
                        <div class="tool-item" draggable="true" data-type="concatenate">
                            <span class="icon">‚ûï</span>
                            <span>Concatenate</span>
                        </div>
                        <div class="tool-item" draggable="true" data-type="split">
                            <span class="icon">‚úÇÔ∏è</span>
                            <span>Split</span>
                        </div>
                        <div class="tool-item" draggable="true" data-type="casechange">
                            <span class="icon">üî§</span>
                            <span>Case Change</span>
                        </div>
                        <div class="tool-item" draggable="true" data-type="regexreplace">
                            <span class="icon">üîç</span>
                            <span>Regex Replace</span>
                        </div>
                        <div class="tool-item" draggable="true" data-type="copyrename">
                            <span class="icon">üìã</span>
                            <span>Copy/Rename</span>
                        </div>
                    </div>
                </div>
                
                <!-- Data Transformations Group -->
                <div class="tool-group">
                    <div class="tool-group-header" data-group="data-transform">
                        <span class="group-icon">‚ñº</span>
                        <span class="group-title">Transformations</span>
                    </div>
                    <div class="tool-group-items" data-group-items="data-transform">
                        <div class="tool-item" draggable="true" data-type="math">
                            <span class="icon">üî¢</span>
                            <span>Math</span>
                        </div>
                        <div class="tool-item" draggable="true" data-type="dateformat">
                            <span class="icon">üìÖ</span>
                            <span>Date Format</span>
                        </div>
                        <div class="tool-item" draggable="true" data-type="expression">
                            <span class="icon">üìù</span>
                            <span>Expression</span>
                        </div>
                    </div>
                </div>
                
                <!-- Legacy Group -->
                <div class="tool-group">
                    <div class="tool-group-header" data-group="legacy">
                        <span class="group-icon">‚ñº</span>
                        <span class="group-title">Legacy</span>
                    </div>
                    <div class="tool-group-items" data-group-items="legacy">
                        <div class="tool-item" draggable="true" data-type="transform">
                            <span class="icon">‚öôÔ∏è</span>
                            <span>Transform (Legacy)</span>
                        </div>
                    </div>
                </div>
            </aside>
            
            <!-- Canvas for building ETL flow -->
            <main class="canvas" id="canvas">
                <p class="hint">Sleep componenten naar hier om te beginnen</p>
                
                <!-- Save/Load Flow Controls -->
                <div class="flow-controls">
                    <button id="saveFlowBtn" class="flow-btn" title="Opslaan Flow">üíæ</button>
                    <button id="loadFlowBtn" class="flow-btn" title="Openen Flow">üìÇ</button>
                    <button id="logFlowBtn" class="flow-btn" title="Data Flow Log">üìã</button>
                    <button id="dataViewBtn" class="flow-btn" title="Data View - Bekijk alle data" aria-label="Open Data View">üëÅÔ∏è</button>
                    <input type="file" id="loadFlowInput" accept=".json" style="display: none;" />
                </div>
            </main>
        </div>
    </div>
    
    <!-- Modal for Data Input -->
    <div id="inputModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Input Source Data</h2>
            <input type="file" id="fileInput" accept=".csv" />
            <div id="fileInfo"></div>
        </div>
    </div>
    
    <!-- Modal for Data Preview (Universal) -->
    <div id="dataPreviewModal" class="modal">
        <div class="modal-content large">
            <span class="close">&times;</span>
            <h2 id="dataPreviewTitle">Data Preview</h2>
            <div id="dataPreviewDisplay"></div>
        </div>
    </div>
    
    <!-- Modal for Output Format -->
    <div id="outputModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Target Structure Template</h2>
            <input type="file" id="templateInput" accept=".csv" />
            <div id="templateInfo"></div>
        </div>
    </div>
    
    <!-- Modal for Automapper -->
    <div id="automapperModal" class="modal">
        <div class="modal-content large">
            <div class="modal-header">
                <span class="close">&times;</span>
                <h2>Automapper</h2>
                <button id="applyAutomapperTop" class="modal-action-top" title="Apply Auto-Mappings">Apply</button>
            </div>
            <div class="modal-body">
                <p style="font-size: 13px; color: #666; margin-bottom: 15px;">Automatically generated column mappings</p>
                <div id="automapperInterface"></div>
                <div style="margin-top: 20px; display: flex; gap: 10px;">
                    <button id="applyAutomapper" style="padding: 10px 20px; background: #4a90e2; color: white; border: none; border-radius: 4px; cursor: pointer;">Apply Auto-Mappings</button>
                    <button id="sendToMapping" style="padding: 10px 20px; background: #2ecc71; color: white; border: none; border-radius: 4px; cursor: pointer;">Send to Mapping Block</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal for Mapping -->
    <div id="mappingModal" class="modal">
        <div class="modal-content large">
            <div class="modal-header">
                <span class="close">&times;</span>
                <h2>Column Mapping</h2>
                <button id="applyMappingTop" class="modal-action-top" title="Apply Mapping">Apply</button>
            </div>
            <div class="modal-body">
                <p style="font-size: 13px; color: #666; margin-bottom: 15px;">Map input columns to output columns</p>
                <div id="mappingInterface"></div>
                <button id="applyMapping" style="margin-top: 20px; padding: 10px 20px; background: #4a90e2; color: white; border: none; border-radius: 4px; cursor: pointer;">Apply Mapping</button>
            </div>
        </div>
    </div>
    
    <!-- Modal for Transform -->
    <div id="transformModal" class="modal">
        <div class="modal-content large">
            <div class="modal-header">
                <span class="close">&times;</span>
                <h2>Transform</h2>
                <button id="applyTransformTop" class="modal-action-top" title="Apply Transform">Apply</button>
            </div>
            <div class="modal-body">
                <p style="font-size: 13px; color: #666; margin-bottom: 15px;">Configure data transformation</p>
                <div id="transformInterface"></div>
                <button id="applyTransform" style="margin-top: 20px; padding: 10px 20px; background: #4a90e2; color: white; border: none; border-radius: 4px; cursor: pointer;">Apply Transform</button>
            </div>
        </div>
    </div>
    
    <!-- Modal for Output Data -->
    <div id="outputDataModal" class="modal">
        <div class="modal-content large">
            <span class="close">&times;</span>
            <h2>Output Data - Export</h2>
            <p style="font-size: 13px; color: #666; margin-bottom: 15px;">Preview and export transformed data</p>
            <div id="outputDataInterface"></div>
            <div style="margin-top: 20px; border-top: 1px solid #ddd; padding-top: 20px;">
                <h3 style="margin-bottom: 10px; font-size: 14px;">Export Options</h3>
                <div style="margin-bottom: 15px;">
                    <label style="display: block; margin-bottom: 5px; font-size: 13px;">Filename Pattern:</label>
                    <input type="text" id="exportFilename" placeholder="e.g., S_AUFK#YYYYMMDD" 
                           style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; font-size: 13px;" />
                    <p style="font-size: 11px; color: #888; margin-top: 5px;">
                        Use # to separate prefix/postfix. Tokens: YYYYMMDD, YYYYMMDD_HHMMSS, YYYY-MM-DD
                    </p>
                </div>
                <div style="display: flex; gap: 10px;">
                    <button id="exportOutputCSV" style="padding: 10px 20px; background: #2ecc71; color: white; border: none; border-radius: 4px; cursor: pointer;">Export CSV</button>
                    <button id="exportOutputXLSX" style="padding: 10px 20px; background: #3498db; color: white; border: none; border-radius: 4px; cursor: pointer;">Export XLSX</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal for Validation -->
    <div id="validationModal" class="modal">
        <div class="modal-content large">
            <span class="close">&times;</span>
            <h2>Validation</h2>
            <p style="font-size: 13px; color: #666; margin-bottom: 15px;">Configure validation rules for data columns</p>
            <div id="validationInterface"></div>
            <button id="applyValidation" style="margin-top: 20px; padding: 10px 20px; background: #4a90e2; color: white; border: none; border-radius: 4px; cursor: pointer;">Apply Validation</button>
        </div>
    </div>
    
    <!-- Modal for Data View -->
    <div id="dataViewModal" class="modal">
        <div class="modal-content large">
            <span class="close">&times;</span>
            <h2>Data View</h2>
            <p style="font-size: 13px; color: #666; margin-bottom: 15px;">View data flowing through this block</p>
            <div id="dataViewInterface"></div>
        </div>
    </div>
    
    <!-- Modal for Value Mapper -->
    <div id="valueMapperModal" class="modal">
        <div class="modal-content large">
            <div class="modal-header">
                <span class="close">&times;</span>
                <h2>Value Mapper</h2>
                <button id="applyValueMapperTop" class="modal-action-top" title="Apply Value Mappings">Apply</button>
            </div>
            <div class="modal-body">
                <p style="font-size: 13px; color: #666; margin-bottom: 15px;">Define value mappings for data columns</p>
                <div id="valueMapperInterface"></div>
                <button id="applyValueMapper" style="margin-top: 20px; padding: 10px 20px; background: #4a90e2; color: white; border: none; border-radius: 4px; cursor: pointer;">Apply Value Mappings</button>
            </div>
        </div>
    </div>
    
    <!-- Modal for Concatenate -->
    <div id="concatenateModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Concatenate</h2>
            <p style="font-size: 13px; color: #666; margin-bottom: 15px;">Combine multiple columns into one</p>
            <div id="concatenateInterface"></div>
            <button id="applyConcatenate" style="margin-top: 20px; padding: 10px 20px; background: #4a90e2; color: white; border: none; border-radius: 4px; cursor: pointer;">Apply</button>
        </div>
    </div>
    
    <!-- Modal for Split -->
    <div id="splitModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Split</h2>
            <p style="font-size: 13px; color: #666; margin-bottom: 15px;">Split a column on a delimiter</p>
            <div id="splitInterface"></div>
            <button id="applySplit" style="margin-top: 20px; padding: 10px 20px; background: #4a90e2; color: white; border: none; border-radius: 4px; cursor: pointer;">Apply</button>
        </div>
    </div>
    
    <!-- Modal for Case Change -->
    <div id="caseChangeModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Case Change</h2>
            <p style="font-size: 13px; color: #666; margin-bottom: 15px;">Change text case</p>
            <div id="caseChangeInterface"></div>
            <button id="applyCaseChange" style="margin-top: 20px; padding: 10px 20px; background: #4a90e2; color: white; border: none; border-radius: 4px; cursor: pointer;">Apply</button>
        </div>
    </div>
    
    <!-- Modal for Math -->
    <div id="mathModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Math</h2>
            <p style="font-size: 13px; color: #666; margin-bottom: 15px;">Perform mathematical operations</p>
            <div id="mathInterface"></div>
            <button id="applyMath" style="margin-top: 20px; padding: 10px 20px; background: #4a90e2; color: white; border: none; border-radius: 4px; cursor: pointer;">Apply</button>
        </div>
    </div>
    
    <!-- Modal for Regex Replace -->
    <div id="regexReplaceModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Regex Replace</h2>
            <p style="font-size: 13px; color: #666; margin-bottom: 15px;">Find and replace using regular expressions</p>
            <div id="regexReplaceInterface"></div>
            <button id="applyRegexReplace" style="margin-top: 20px; padding: 10px 20px; background: #4a90e2; color: white; border: none; border-radius: 4px; cursor: pointer;">Apply</button>
        </div>
    </div>
    
    <!-- Modal for Date Format -->
    <div id="dateFormatModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Date Format</h2>
            <p style="font-size: 13px; color: #666; margin-bottom: 15px;">Parse and reformat dates</p>
            <div id="dateFormatInterface"></div>
            <button id="applyDateFormat" style="margin-top: 20px; padding: 10px 20px; background: #4a90e2; color: white; border: none; border-radius: 4px; cursor: pointer;">Apply</button>
        </div>
    </div>
    
    <!-- Modal for Expression -->
    <div id="expressionModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Expression</h2>
            <p style="font-size: 13px; color: #666; margin-bottom: 15px;">Evaluate expressions with column values</p>
            <div id="expressionInterface"></div>
            <button id="applyExpression" style="margin-top: 20px; padding: 10px 20px; background: #4a90e2; color: white; border: none; border-radius: 4px; cursor: pointer;">Apply</button>
        </div>
    </div>
    
    <!-- Modal for Copy/Rename -->
    <div id="copyRenameModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Copy/Rename</h2>
            <p style="font-size: 13px; color: #666; margin-bottom: 15px;">Copy or rename a column</p>
            <div id="copyRenameInterface"></div>
            <button id="applyCopyRename" style="margin-top: 20px; padding: 10px 20px; background: #4a90e2; color: white; border: none; border-radius: 4px; cursor: pointer;">Apply</button>
        </div>
    </div>
    
    <!-- Modal for Join -->
    <div id="joinModal" class="modal">
        <div class="modal-content large">
            <div class="modal-header">
                <span class="close">&times;</span>
                <h2>Join</h2>
                <button id="applyJoinTop" class="modal-action-top" title="Apply Join">Apply</button>
            </div>
            <div class="modal-body">
                <p style="font-size: 13px; color: #666; margin-bottom: 15px;">Join two datasets on matching keys</p>
                <div id="joinInterface"></div>
                <button id="applyJoin" style="margin-top: 20px; padding: 10px 20px; background: #4a90e2; color: white; border: none; border-radius: 4px; cursor: pointer;">Apply</button>
            </div>
        </div>
    </div>
    
    <!-- Modal for Rejected Output -->
    <div id="rejectedOutputModal" class="modal">
        <div class="modal-content large">
            <span class="close">&times;</span>
            <h2>Rejected Output - Export</h2>
            <p style="font-size: 13px; color: #666; margin-bottom: 15px;">Preview and export rejected records from validation</p>
            <div id="rejectedOutputInterface"></div>
            <div style="margin-top: 20px; border-top: 1px solid #ddd; padding-top: 20px;">
                <h3 style="margin-bottom: 10px; font-size: 14px;">Export Options</h3>
                <div style="margin-bottom: 15px;">
                    <label style="display: block; margin-bottom: 5px; font-size: 13px;">Filename Pattern:</label>
                    <input type="text" id="rejectedExportFilename" placeholder="e.g., rejected#YYYYMMDD" 
                           style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; font-size: 13px;" />
                    <p style="font-size: 11px; color: #888; margin-top: 5px;">
                        Use # to separate prefix/postfix. Tokens: YYYYMMDD, YYYYMMDD_HHMMSS, YYYY-MM-DD
                    </p>
                </div>
                <div style="display: flex; gap: 10px;">
                    <button id="exportRejectedCSV" style="padding: 10px 20px; background: #e74c3c; color: white; border: none; border-radius: 4px; cursor: pointer;">Export CSV</button>
                    <button id="exportRejectedXLSX" style="padding: 10px 20px; background: #c0392b; color: white; border: none; border-radius: 4px; cursor: pointer;">Export XLSX</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal for Logging -->
    <div id="loggingModal" class="modal">
        <div class="modal-content large">
            <span class="close">&times;</span>
            <h2>Data Flow Log</h2>
            <p style="font-size: 13px; color: #666; margin-bottom: 15px;">Textual representation of data flow and transformations</p>
            <div id="loggingInterface" style="max-height: 500px; overflow-y: auto; font-family: monospace; font-size: 12px; background: #f5f5f5; padding: 15px; border-radius: 4px; line-height: 1.6;"></div>
            <button id="clearLog" style="margin-top: 20px; padding: 10px 20px; background: #e74c3c; color: white; border: none; border-radius: 4px; cursor: pointer;">Clear Log</button>
        </div>
    </div>
    
    <script src="app.js"></script>
</body>
</html>
